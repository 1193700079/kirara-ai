import{C as A,N as I}from"./ConfigurationList.js";import{i as z,j as L,k as O,d as y,o as t,c as o,a as n,l as P,r as f,F as S,m as $,f as u,n as _,b as q,u as D,t as b,p as v,N as M,q as V,s as R,x as F,y as H,z as G,_ as J}from"./index.js";import{a as K,u as U}from"./use-message.js";import"./cryptojs.js";function Q(){const i=z(O,null);return i===null&&L("use-dialog","No outer <n-dialog-provider /> founded."),i}const W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},X=n("path",{d:"M376 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Y=n("path",{d:"M288 304c-87 0-175.3 48-191.64 138.6c-2 10.92 4.21 21.4 15.65 21.4H464c11.44 0 17.62-10.48 15.65-21.4C463.3 352 375 304 288 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),Z=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M88 176v112"},null,-1),ee=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M144 232H32"},null,-1),te=[X,Y,Z,ee],oe=y({name:"PersonAddOutline",render:function(p,a){return t(),o("svg",W,te)}}),ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},se=P('<path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352" fill="currentColor"></path><path d="M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 176v224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M184 176l8 224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M328 176l-8 224"></path>',6),re=[se],ae=y({name:"TrashOutline",render:function(p,a){return t(),o("svg",ne,re)}}),ie=i=>(F("data-v-0840cc8b"),i=i(),H(),i),ce={class:"sub-content-wrapper"},le={class:"sidebar-wrapper"},ue=ie(()=>n("div",{class:"sidebar-title"},[n("p",null,"账号管理")],-1)),de={class:"sidebar"},pe={class:"sidebar-nav"},he={class:"sidebar-nav-item"},ve={class:"sidebar-nav-text"},_e={class:"sidebar-nav-child"},ke=["onClick"],fe={key:0,class:"account-remark"},ge={key:1,class:"account-remark"},we={key:2,class:"account-status",style:{color:"mediumseagreen"}},me={key:3,class:"account-status",style:{color:"brown"}},Ce={key:0,class:"sub-main-content-wrapper"},be={key:1,class:"sub-main-content-wrapper"},ye=y({__name:"AccountConfigView",setup(i){D();const p=K(),a=U(),N=Q(),c=f(-1),l=f("chatgpt-web"),m=f([]),k=f({}),d=f(null);async function x(){const s=await(await fetch("/backend-api/v1/accounts/model?key="+l.value)).json();delete s.properties.ok,m.value=[s]}async function C(){var h;const s=await(await fetch("/backend-api/v1/accounts/list")).json();k.value=s;const e=G();(h=e==null?void 0:e.proxy)==null||h.$forceUpdate()}function B(r,s){l.value=r,c.value=s,g()}function g(){a.start(),x().then(()=>d.value?(d.value={},Promise.resolve()):C()).then(()=>{a.finish()}).catch(r=>{p.error("配置读取失败！"),console.error(r),a.error()})}function j(r){a.start();const s="/backend-api/v1/accounts/"+l.value+(d.value?"":"/"+c.value);fetch(s,{method:"POST",body:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>{if(e.ok)return p.success("配置保存成功！"),a.finish(),e.json();throw new Error("Something went wrong.")}).then(C).then(()=>{d.value=null}).catch(e=>{p.error("配置保存失败！"),a.error()})}function T(r){c.value=-1,d.value={},l.value=r,x()}function E(r,s){N.warning({title:"删除账号",content:"你确定要删除这个账号吗？希望你不是点错了。",positiveText:"很确定",negativeText:"点错了",onPositiveClick:()=>{fetch("/backend-api/v1/accounts/"+l.value+"/"+c.value,{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>{if(e.ok)return p.success("账号已删除"),a.finish(),e.json();throw new Error("Something went wrong.")}).then(C).catch(e=>{p.error("账号删除失败"),a.error()}),c.value=-1,d.value=null}})}return g(),(r,s)=>(t(),o("div",ce,[n("div",le,[ue,n("div",de,[n("ul",pe,[(t(!0),o(S,null,$(Object.keys(k.value),e=>(t(),o("li",{key:e},[n("div",he,[n("div",ve,b(k.value[e].model.title),1),u(v(I),{class:"sidebar-nav-action"},{default:_(()=>[u(v(M),{quaternary:"",size:"tiny",onClick:h=>T(e)},{icon:_(()=>[u(v(V),null,{default:_(()=>[u(v(oe))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),n("ul",_e,[(t(!0),o(S,null,$(k.value[e].accounts,(h,w)=>(t(),o("li",{class:R({"sidebar-nav-sub-item":!0,"sidebar-nav-sub-item-active":c.value==w&&l.value==e}),onClick:xe=>B(e,w),key:w},[n("div",null,[h.remarks?(t(),o("p",fe,b(h.remarks),1)):(t(),o("p",ge,"账号 "+b(w+1),1)),h.ok?(t(),o("p",we,"可用")):(t(),o("p",me,"不可用"))])],10,ke))),128))])]))),128))])])]),c.value>=0?(t(),o("div",Ce,[u(A,{title:"修改账号","configuration-groups":m.value,configurationValue:k.value[l.value].accounts[c.value],onSave:j,onReset:g},{tools:_(()=>[u(v(M),{quaternary:"",onClick:s[0]||(s[0]=e=>E(l.value,c.value))},{icon:_(()=>[u(v(V),null,{default:_(()=>[u(v(ae))]),_:1})]),_:1})]),_:1},8,["configuration-groups","configurationValue"])])):d.value?(t(),o("div",be,[u(A,{title:"添加账号："+l.value,"configuration-groups":m.value,configurationValue:d.value,onSave:j,onReset:g},null,8,["title","configuration-groups","configurationValue"])])):q("",!0)]))}});const Me=J(ye,[["__scopeId","data-v-0840cc8b"]]);export{Me as default};
