name: default_workflow
blocks:
  - type: internal:get_message
    name: get_message
    params: {}
    connected_to:
      - target: toggle_edit_state_5qnvx8
        mapping:
          from: msg
          to: msg
      - target: query_memory
        mapping:
          from: msg
          to: msg
      - target: construct_llm_message_tulgdy
        mapping:
          from: msg
          to: user_msg
      - target: store_memory_i4nhol
        mapping:
          from: msg
          to: user_msg
  - type: internal:toggle_edit_state
    name: toggle_edit_state_5qnvx8
    params:
      is_editing: true
    parallel: true
  - type: internal:query_memory
    name: query_memory
    params: {}
    parallel: true
    connected_to:
      - target: construct_llm_message_tulgdy
        mapping:
          from: memory_content
          to: memory_content
  - type: internal:construct_llm_message
    name: construct_llm_message_tulgdy
    params:
      system_prompt_format: "你是一个智能助手。以下是之前的对话历史：\n{memory_content}\n\n请基于以上历史记忆，回答用户的问题。"
      user_prompt_format: '{user_msg}'
    connected_to:
      - target: llm_chat
        mapping:
          from: llm_msg
          to: prompt
  - type: internal:llm_chat
    name: llm_chat
    params: {}
    connected_to:
      - target: llm_to_msg_vfxsdf
        mapping:
          from: resp
          to: resp
      - target: store_memory_i4nhol
        mapping:
          from: resp
          to: llm_resp
  - type: internal:llm_to_message
    name: llm_to_msg_vfxsdf
    params: {}
    connected_to:
      - target: msg_sender_5dgezx
        mapping:
          from: msg
          to: msg
      - target: toggle_edit_state_0b08t6
        mapping:
          from: msg
          to: msg
  - type: internal:send_message
    name: msg_sender_5dgezx
    params: {}
    parallel: true
  - type: internal:store_memory
    name: store_memory_i4nhol
    params: {}
    parallel: true
  - type: internal:toggle_edit_state
    name: toggle_edit_state_0b08t6
    params:
      is_editing: false
    parallel: true
